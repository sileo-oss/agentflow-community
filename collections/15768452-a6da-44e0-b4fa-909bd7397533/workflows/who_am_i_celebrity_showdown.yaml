name: Who Am I Celebrity Showdown
description: An interactive, AI-driven game where a human player competes against an AI role-playing as a celebrity to guess a secret character by asking yes-or-no questions.
diagram: |
  graph TD
      A[start_game] --> B{player_turn};
      B --> C{process_turns};
      C -- incorrect guess --> B;
      C -- correct guess --> D{check_win_condition};
      C -- limit reached --> E[end_round];
      D --> E;
      E --> A;
      E --> F[exit_game];
steps:
  - name: start_game
    description: Initializes the game, sets up the secret character, and the AI celebrity persona.
    actions:
      - "Prompt user for game theme (default: movie characters)."
      - "Prompt user for AI celebrity (default: random)."
      - "Select a secret character based on theme."
      - "Ensure secret character is not the same as the AI celebrity; re-select if necessary."
      - "Initialize AI celebrity persona (personality, speech style)."
      - "Inform players about the secret character (not its identity, but that it's chosen)."
      - "Set current_question_count to 0."
      - "Set question_limit to 5."
    user_prompt: |
      Let's start the game!
      What theme would you like for the secret character? (e.g., movie characters, historical figures, sci-fi, or leave blank for random movie character)
      Which celebrity would you like to compete against? (e.g., Jack Nicholson, Donald Trump, Meryl Streep, or leave blank for a random celebrity)
    context:
      read_keys: []
      write_keys:
        - game_theme
        - celebrity_choice
        - secret_character_id
        - secret_character_metadata
        - ai_celebrity_persona
        - current_question_count
        - question_limit
    allowed_next_steps:
      - player_turn
    continuation_logic: "After game setup, proceed to the human player's turn."
    success_condition: "Game setup complete, secret character and celebrity persona initialized."

  - name: exit_game
    description: Ends the game session.
    actions:
      - "Display a farewell message."
    user_prompt: |
      Thanks for playing! See you next time!
    context:
      read_keys: []
      write_keys: []
    allowed_next_steps: []
    continuation_logic: "End of workflow."
    success_condition: "Game session terminated."

  - name: player_turn
    description: Handles the human player's turn to ask a yes-or-no question.
    actions:
      - "Prompt human player for a yes-or-no question."
    context:
      read_keys:
        - current_question_count
        - question_limit
      write_keys:
        - human_question_text
    user_prompt: |
      Your turn! You have {{ 5 - current_question_count }} questions left. Ask a yes-or-no question about the secret character, or make a guess.
    allowed_next_steps:
      - process_turns
    continuation_logic: "Proceed to process both turns."
    success_condition: "Human has submitted a question."

  - name: process_turns
    description: Processes both the human's and the AI's turns, providing answers and displaying results in a single step.
    actions:
      - "Parse the human's question."
      - "Answer the human's question based on secret_character_metadata."
      - "Check if the human player's question is a guess and set human_guessed_correctly."
      - "Increment current_question_count."
      - "Generate a dynamic interjection for the AI celebrity."
      - "Generate a yes-or-no question from the AI celebrity persona."
      - "Answer the AI celebrity's question based on secret_character_metadata."
      - "Check if the AI celebrity's question is a guess and set ai_guessed_correctly."
    context:
      read_keys:
        - secret_character_metadata
        - human_question_text
        - current_question_count
        - question_limit
        - ai_celebrity_persona
      write_keys:
        - moderator_answer_to_human
        - human_guessed_correctly
        - current_question_count
        - ai_celebrity_question_text
        - moderator_answer_to_ai
        - ai_guessed_correctly
    user_prompt: |
      You asked: "{{human_question_text}}"
      Moderator's answer: {{moderator_answer_to_human}}
      ---
      {{ai_celebrity_persona.name}} says: {{ai_celebrity_persona.interjection}}
      {{ai_celebrity_persona.name}} asks: {{ai_celebrity_question_text}}
      Moderator's answer to {{ai_celebrity_persona.name}}: {{moderator_answer_to_ai}}
    allowed_next_steps:
      - check_win_condition
      - player_turn
      - end_round
    continuation_logic: "If human_guessed_correctly or ai_guessed_correctly, go to check_win_condition. If question_limit is reached, go to end_round. Otherwise, go to player_turn."
    success_condition: "Both turns processed and results displayed."

  - name: check_win_condition
    description: Determines if a player has won the round.
    actions:
      - "If human_guessed_correctly is true, declare human winner."
      - "If ai_guessed_correctly is true, declare AI winner."
      - "Set game_outcome_message based on who won."
      - "Set celebrity_end_reaction based on the outcome."
    context:
      read_keys:
        - human_guessed_correctly
        - ai_guessed_correctly
        - ai_celebrity_persona
        - secret_character_id
      write_keys:
        - round_winner
        - celebrity_end_reaction
        - game_outcome_message
    allowed_next_steps:
      - end_round
    continuation_logic: "Proceed to end_round after determining the winner."
    success_condition: "Round winner determined."

  - name: end_round
    description: Concludes the current round and offers replay options.
    actions:
      - "Reveal secret character if not already guessed."
      - "Display celebrity's reaction to the outcome."
      - "Prompt user to play again, change settings, or exit."
    user_prompt: |
      {{game_outcome_message}}
      The round has ended! The secret character was: {{secret_character_id}}.
      {{celebrity_end_reaction}}
      Would you like to play again, change settings, or exit? (play/settings/exit)
    context:
      read_keys:
        - secret_character_id
        - ai_celebrity_persona
        - round_winner
        - celebrity_end_reaction
        - game_outcome_message
      write_keys:
        - user_replay_choice
    allowed_next_steps:
      - start_game
      - exit_game
    continuation_logic: "If user chooses to play again or change settings, go to start_game. If user chooses to exit, go to exit_game."
    success_condition: "Round concluded and user prompted for next action."